[toc]

# 变量和函数

## 事件中的input提升为变量后为空

事件其中的input可以直接使用到其他节点,但是如果提升为变量,变量会是空的,就需要给这个变量set赋值后再使用;



# AI

## AI追人延迟使用计时器 timer的作用

timer和延迟类似,是隔一段时间,再去执行连接的事件,不是在这个事件内去执行;

## 设置AI不生效

AI要生效,要在AI控制器中指定行为树,并在AI角色蓝图中指定AI控制器;



# 骨骼资源

## 骨骼网络的碰撞添加

首先,需要在使用骨骼的类中,设置碰撞开启

然后

选中骨骼网格,右键创建物理资源,调整物理资源的大小和位置

>  注意,物理资源是橙黄色的,意思表明和骨骼网格不是同一个东西

还需要在物理资产中,开启碰撞反馈,方便其他物体碰撞到他后会有效果

最后在骨骼网格中,添加刚才创建的物理资源





# 互动物品

## 物品的拾取

如果互动的是机关触发类,物品可以直接销毁掉

如果是可以拾取的武器或者,就不要销毁 ,否则就算放下或者把物品挂身上都无法实现;



# 蓝图继承问题

对于一开始就必须需要独自设置的变量,可以用一个函数,来统一设置一下,比每个子蓝图都要在beginPlay中设置方便,也不容易遗漏





# 范围爆炸问题

范围爆炸后,需要遍历循环每个受影响的物体并施加作用力



# 不播放死亡的蒙太奇动画

## 蒙太奇的设置

在NPC蓝图中触发蒙太奇动画

逻辑方面:

生命值设置为0

销毁NPC的UI **DestroyComponent**

播放蒙太奇

销毁actor,destroy actor

## 问题1

蒙太奇的播放必须在动画蓝图插槽中设置，直接使用是不行的

## 问题2 可能是因为写在方法中

试着在event里加入死亡动画，无效

换节点 play Montage

使用on Completed





# 倒地死亡还有AI进行控制

- 方法一

  - 尝试在行为树中加入判断，AI的控制由行为树-黑板-控制器3部分组成

  - 因为AI蓝图没有控制器，只有下面各个分身有，那么在行为树-黑板中找方法

  - 行为树无法直接修改黑板中的值，只有行为树中的自定义任务可以操作黑板的值

  - 方法麻烦，放弃

- 方法二

  - 使用 set ai controller class， 死亡后断开AI控制器，但是并不生效

  - 使用 Detach from controller pending destroy ，有效，但是NPC最后会站起来



# 解决NPC播放完死亡动画后站起来的问题

- 原因是不会立刻消除，这一点时间会恢复到默认姿势

- 利用蒙太奇的通知功能，提前一点执行消失功能；



# NPC互相AI检测导致行为异常

[UE4实战技巧（二）AI视觉感知的所有Pawn均检测问题_永远的小白虾的博客-CSDN博客_ue4 视觉感知](https://blog.csdn.net/qq_41487299/article/details/121231128)

[/Script/AIModule.AISense_Sight]
bAutoRegisterAllPawnsAsSources=False



# 黑板任务设置黑板值无效

还需要把行为树任务中设置的黑板键类型和真正的黑板变量对应上



# 设置攻击盒子时使用begin overlap无法触发

如果人物已经在collision box里面，然后此时开启 collision box ，人物已经在box中，无法触发begin。

而且如果用碰撞的方式，这时会一直碰撞，导致碰撞消息一直触发，人物会一直扣血，建议直接用蒙太奇的通知+判断人物是否在攻击范围内去直接触发人物的扣血

首先我们知道

> *实体有自身的碰撞通道类型*
>
> *每个实体用碰撞预设来对应是否对其他的碰撞通道类型实体产生碰撞*

主角的类型为pawn ，他对attactPlayer通道是overlap，对worldDynamic是block;

punchbox的类型为worldDynamic，对pawn类型是 ignore,自然会识别不到



# AI controller设置 actor类型到黑板中不生效

不是不生效,是运算太快

# mixamo 下载的动画无法加载

- 网站上有的模型是无法适配UE4的
- 要所有模型都能用,使用mixamo_converter工具,上传UE的人物模型,自动适配动作再下载;



# 远程AI总是来回跑,EQS的结果不好调试

- 看到玩家时玩家会自然躲开，导致`是否看到玩家`这个值立刻被重置,让NPC无法做出看到玩家后该有的操作
- selector下面的条件最好一致,不要用两个不同的布尔值放在同一个selector下,否则容易出问题;
- 使用的是服务器节点,每隔几秒才执行一次,会显得NPC卡在那思考
- 修改EQS中的trace的 bool match 判断条件

# 远程AI 射击时没有面对当前玩家的位置,而是面对第一次看到玩家的位置

- 使用get actor of class 不要用  get player control;



# 玩家死了重来,AI不会重置

- 需要一个发报机，当死亡的时候通知AI，做各种类型的重置工作



# AI射击时没有正对玩家

- 动画问题,修改动画角度



# 人物受到攻击时全屏出现半透明的红色模糊效果

1. 直接使用UI模糊控件修改颜色
   - 经过一晚上的学习，确认无法直接修改模糊控件的颜色
2. 使用材质,在模糊控件后面再加一层红色图片I
   - 把材质的域修改为 ue interface类型就可以
   - 根据受到的伤害大小控制图片透明度
3. 使用后期处理



# 动态血色环UI为什么一定要用材质

- 需要做到红色，并且能调整，可以直接用图片
- 还要做到渐变，就需要叠加纹理，无法用一张图片实现效果，需要材质



# 主角的类单独命名为其他的名字

就算用的系统提供的也需要单独提供其他名字，因为后面如果有其他，比如第三方人物类，就容易和主角搞混

如果主角和第三方NPC都是用的第三人称模板，那么在其他蓝图（比如AI）中，需要经常获取到主角的类，如果直接获取第三人称模板类，主角和第三方NPC都算这个的子类，就怕获取错误，如果每个都单独命名，就会严谨很多。



# 每次生成新的主角要更新UI绑定的角色

创建一个发报机，把UI的生成绑定到发报机上，每次角色执行死亡重生的函数，就会call 发报机。然后绑定在发报机上的事件就会依次调用。





# 暂停后无法接受指令

使用P键按下的事件暂停，再使用P键没有效果，需要在暂停的输入事件中勾选**暂停也能接受执行**



# 多个相同AI，NPC如果没有进入战斗则无事，但是一旦进入战斗，如果有其他AI做了攻击动作，也会一起做攻击

- 离玩家近在执行行为树中一定被改了；

- 但是通过打印知道在行为树中的判读是没有错的；
  - 要么是执行完打印后被改了；
  - 会不会有一种可能，AI control 设置的黑板值可以每个AI分开设置，但是行为树中设置的黑板值会同时设置？
    - 测试中。。。。
    - 首先进入行为树的是单独的玩家，而且cast to  还是正常的
  
- 优化行为树任务节点，做到更粒子话，将变量和任务节点中剥离出来，尽量做到一个节点只涉及一个变量

  - 将行为树优化后，发现出问题的NPC，行为树有问题，在执行到正常行为树中途突然变卦
  - 用一个方法，把装饰器的结果`变更后自否停止自身`关闭，问题可以掩盖过去

- 一旦运行到攻击这个节点，所有的`IsCloseEmeny`黑板变量全是为true;

- 只有一种可能，任务中直接设置黑板键是所有设置，尝试改到AIC中设置这个值；

- 上面的方法都失败了，查询黑板键，有关键字**实例已同步**;

  



# AI control 中写位置需要注意的点

AIC有位置，他会自动生成在AI_NPC一开始的位置，在AIC中使用的 self，是指AIC的位置，不是pawn的位置



# C++中使用component

建立了一个pawn类，想往里面添加骨骼组件，使用骨骼C++类报错，因为类中添加的骨骼组件类必须是组件类，必须带component关键字



# C++创建pawn，mesh导入模型没有显示

- 是模型变到其他地方了
- 排查是transform属性不完整，无法设置位置和面向
-  要同时设置根节点和父节点，有了相对关系，才有相对位置

