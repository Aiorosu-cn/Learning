[TOC]

# TCP和UDP特点

| 特性     | TCP                                                        | UDP                              |
| -------- | ---------------------------------------------------------- | -------------------------------- |
| 链接性   | 面向链接                                                   | 不在乎是否收到只在乎能不能发送到 |
| 稳定性   | 不会丢包                                                   | 丢包                             |
| 服务回应 | 服务器能检测到服务断掉                                     | 服务器不清楚服务是否断掉         |
| 信息头   | 为了保证链接，为了维护协议的结构，还需要加20字节作为信息头 | 还需要加8字节作为信息头          |

# UDP写法

## 1.初始化和TCP一样

和TCP差不多，使用的头文件都一样



## 2.创建套接字要选择UDP协议



## 3.设置地址端口



## 4.绑定



## 5.收发数据

TCP在收发数据前，还需要创建监听接口，而UDP不需要，绑定后直接就能收发数据

> UDP使用 recvfrom函数来接受数据，默认也是阻塞的
>
> 要设置为非阻塞，使用setsockopt函数来设置[setsockopt_百度百科 (baidu.com)](https://baike.baidu.com/item/setsockopt/10069288?fr=aladdin)
>
> UDP使用sendto()发送消息，不存在是否阻塞，因为发送他也不管结果

UDP要注意发送数据的大小，他不能保证发送的顺序和到达率，UDP数据的长度一次有一个限制

在局域网，广域网中，大小不同，

我们可以改造UDP，让他成为`可靠的UDP`



# 最大UDP数据量

MTU的值并不包括链路层的首部和尾部的18个字节。所以，这个1500字节就是网络层IP数据报的长度限制。因为IP数据报的首部为20字节，所以IP数据报的数据区长度最大为1480字节。而这个1480字节就是用来放TCP传来的TCP报文段或UDP传来的UDP数据报的。又因为UDP数据报的首部8字节,所以UDP数据报的数据区最大长度为1472字节。这个1472字节就是我们可以使用的字节数。

鉴于Internet上的标准MTU值为576字节，所以在进行Internet的UDP编程时，最好将UDP的数据长度控件在548字节(576-8-20)以内。

典型的 IPv4 头部是 20 字节，而 UDP 头部是 8 字节。然而，可以包括 IP 选项，该选项可以将 IP头部的大小增加到多达 60 字节（如图 1 所示）。

此外，有时中间节点需要将数据报封装在另一种协议（如IPsec（用于VPN等））中，以便将数据包路由到其目的地。

因此，如果不知道特定网络路径上的 MTU，最好为可能没有预料到的其他头部信息留出合理的余量。512字节的 UDP 有效载荷通常被认为可以做到这一点，尽管即使这样也没有为最大尺寸的 IP报头留下足够的空间。